<!DOCTYPE html>
<html lang="en">

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link href="../buyer-dashboard/bootstrap.min.css" rel="stylesheet">
        <link href="../buyer-dashboard/buyer-dashboard-style.css" rel="stylesheet">
        
    </head>

    <body>
        <div class="container rounded bg-white mt-5 mb-5" style="padding-top: 80px;">
            <div class="row">
                <div class="col-md-3 border-right">
                    <div class="d-flex flex-column align-items-center text-center p-3 py-5">
                        <img id="itemImg" src="" width="306" height="229.5">

                        <div class="col-md-12" style="padding-top: 20px; padding-bottom: 20px;">
                            <br>
                            <h2 id="itemName"></h2>
                            <h5 style="color: #4CA48C;" id="itemPrice"></h5>
                        </div>
                    </div>
                </div>

                <div class="col-md-5 border-right">
                    <div class="p-3 py-5">
                        <div class="row mt-3">
                            <div class="col-md-12">
                                <label class="labels">Select Color *</label>
                                <div id="colours" style="margin-top: 15px;"> 
                                    
                                </div>
                            </div>

                            <div class="col-md-4" style="padding-top: 15px;" id="quantityDiv">
                            </div>

                            <div class="col-md-12" style="padding-top: 15px;">
                                <label class="labels">Email Address</label>
                                <input id="email" type="text" class="form-control" placeholder="" value="" readonly="readonly">
                            </div>

                            <div class="col-md-12" style="padding-top: 15px;">
                                <label class="labels">Phone Number *</label>
                                <input id="phone" type="text" class="form-control" placeholder="" value="">
                            </div>

                            <div class="col-md-12" style="padding-top: 15px;">
                                <label class="labels">Delivery Address *</label>
                                <input id="address" type="text" class="form-control" placeholder="" value="">
                            </div>

                            <div class="col-md-12" style="padding-top: 15px;">
                                <select id="district" style="color: #676a70;">
                                    <option value="Colombo">Colombo</option>
                                    <option value="Gampaha">Gampaha</option>
                                    <option value="Kalutara">Kalutara</option>
                                    <option value="Kandy">Kandy</option>
                                    <option value="Matale">Matale</option>
                                    <option value="Nuwara Eliya">Nuwara Eliya</option>
                                    <option value="Galle">Galle</option>
                                    <option value="Matara">Matara</option>
                                    <option value="Hambantota">Hambantota</option>
                                    <option value="Jaffna">Jaffna</option>
                                    <option value="Kilinochchi">Kilinochchi</option>
                                    <option value="Mannar">Mannar</option>
                                    <option value="Vavuniya">Vavuniya</option>
                                    <option value="Mullaitivu">Mullaitivu</option>
                                    <option value="Batticallo">Batticallo</option>
                                    <option value="Ampara">Ampara</option>
                                    <option value="Trincomalee">Trincomalee</option>
                                    <option value="Kurunegala">Kurunegala</option>
                                    <option value="Puttalam">Puttalam</option>
                                    <option value="Anuradhapura">Anuradhapura</option>
                                    <option value="Polonnaruwa">Polonnaruwa</option>
                                    <option value="Badulla">Badulla</option>
                                    <option value="Moneragala">Moneragala</option>
                                    <option value="Ratnapura">Ratnapura</option>
                                    <option value="Kegalle">Kegalle</option>
                                </select>
                            </div>

                            <div class="col-md-12" style="padding-top: 15px;">
                                <label class="labels">Delivery Charge</label>
                                <input id="deliveryCharge" type="text" class="form-control" placeholder="" value="" readonly="readonly">
                            </div>

                            <div class="col-md-12" style="padding-top: 15px;">
                                <label class="labels">Estimated Arrival (days)</label>
                                <input id="estimatedArrival" type="text" class="form-control" placeholder="" value="" readonly="readonly">
                            </div>

                        </div>

                    </div>
                </div>

                <div class="col-md-4">
                    <div class="p-3 py-5">
                        <div class="d-flex justify-content-between align-items-center experience">Payment Details</div><br>
                        
                        <div class="col-md-12">
                            <label class="labels" style="padding-top: 15px;">Sub Total</label>
                            <input id="subtotal" type="text" class="form-control" value="" readonly="readonly">
                        </div>

                        <div class="col-md-12">
                            <label class="labels" style="padding-top: 15px;">Delivery Charge</label>
                            <input id="delivery2" type="text" class="form-control" value="LKR 500" readonly="readonly">
                        </div>

                        <div class="col-md-12">
                            <label class="labels" style="padding-top: 15px;">Total Payment</label>
                            <input id="totalPay" type="text" class="form-control" value="LKR 50,500" readonly="readonly">
                        </div>

                        <br><br>
                        <div class="d-flex justify-content-between align-items-center experience">Payment Method *</div><br>
                        <div class="col-md-12">
                            <input type="radio" id="cash" value="Cash on Delivery">
                            <label class="labels" for="cash">Cash on Delivery</label><br>
                            <input type="radio" id="card" value="Card Payment">
                            <label class="labels" for="card">Card Payment</label><br>
                        </div>

                        <div class="mt-5 text-right">
                            <button class="btn btn-primary profile-button" type="button" style="margin-left: 30px;" onclick="resetPass()">Checkout</button>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <script>
            // Buyer id
            var buyerId = localStorage.getItem("id");


            // Details related to the product
            var sellerId = localStorage.getItem("sellerId");
            var productId = localStorage.getItem("productId");
            var stockQuantity = 0;
            var clr1 = "";
            var clr2 = "";
            var clr3 = "";
            var itemImg = document.getElementById("itemImg");
            var itemName = document.getElementById("itemName");
            var itemPrice = document.getElementById("itemPrice");
            var colours = document.getElementById("colours");
            var quantityDiv = document.getElementById("quantityDiv");


            // Set page details
            const setPageDetails = async() => {
                // Set buyer details
                let response2 = await fetch(`http://localhost:8080/findbyId/${buyerId}`);
			    let userDetails = await response2.json();

                document.getElementById("email").value = userDetails.email;

                if(userDetails.contactNo != "NA"){
                    document.getElementById("phone").value = userDetails.contactNo;
                }

                if(userDetails.deliveryAddress != "NA"){
                    document.getElementById("address").value = userDetails.deliveryAddress;
                }
                
                if(userDetails.buyerDistrict != "NA"){
                    document.getElementById("district").value = userDetails.buyerDistrict;
                }


                // Set product details
                let response1 = await fetch(`http://localhost:8080/findUserProducts/${sellerId}`);
                let items = await response1.json();

                for (let i = 0; i < items.length; i++) {
                    if(items[i].itemId == productId){
                        itemImg.src = items[i].clr1Img;
                        itemName.innerHTML = items[i].itemName;
                        itemPrice.innerHTML = `LKR ${(items[i].price).toLocaleString('en-US')}`;

                        coloursInnerHTML = "";
                        
                        coloursInnerHTML += `<span style="height: 30px; width: 30px; background-color: ${items[i].clr1}; border-radius: 50%; display: inline-block; border: 3px solid black;" onclick="setImage1()" id="clr1Img"></span>`;
                        clr1 = items[i].clr1Img;

                        if(items[i].clr2 != ""){
                            coloursInnerHTML += `<span style="height: 30px; width: 30px; background-color: ${items[i].clr2}; border-radius: 50%; display: inline-block; border: 1px solid black; margin-left: 10px;" onclick="setImage2()" id="clr2Img"></span>`;
                            clr2 = items[i].clr2Img;
                        }

                        if(items[i].clr3 != ""){
                            coloursInnerHTML += `<span style="height: 30px; width: 30px; background-color: ${items[i].clr3}; border-radius: 50%; display: inline-block; border: 1px solid black; margin-left: 10px;" onclick="setImage3()" id="clr3Img"></span>`;
                            clr3 = items[i].clr3Img;
                        }

                        colours.innerHTML = coloursInnerHTML;

                        quantityDiv.innerHTML = `<label class="labels">Set Quantity *</label> <input id="quantity" type="number" class="form-control" placeholder="" value="1" style="text-align: center;" min="1" max="${items[i].stockQuantity}">`;
                        
                        var deliveryDistrict = document.getElementById("district").value;
                        
                        if(deliveryDistrict == "Colombo" & items[i].deliveryColombo != 0){
                            document.getElementById("deliveryCharge").value = "LKR " + (items[i].deliveryColombo).toLocaleString('en-US');
                            document.getElementById("delivery2").value = "LKR " + (items[i].deliveryColombo).toLocaleString('en-US');
                            document.getElementById("totalPay").value = "LKR " + (items[i].price + items[i].deliveryColombo).toLocaleString('en-US');
                            document.getElementById("deliveryCharge").style.color = "black";
                            document.getElementById("delivery2").style.color = "black";
                            
                            document.getElementById("estimatedArrival").value = items[i].arrivalColombo;
                            document.getElementById("estimatedArrival").style.color = "black";
                        }else if(deliveryDistrict == "Colombo" & items[i].deliveryColombo == 0){
                            document.getElementById("deliveryCharge").value = "Delivery not available for Colombo";
                            document.getElementById("delivery2").value = "Delivery not available for Colombo";
                            document.getElementById("totalPay").value = "LKR " + (items[i].price + items[i].deliveryColombo).toLocaleString('en-US');
                            document.getElementById("deliveryCharge").style.color = "red";
                            document.getElementById("delivery2").style.color = "red";

                            document.getElementById("estimatedArrival").value = "Delivery not available for Colombo";
                            document.getElementById("estimatedArrival").style.color = "red";
                        }

                        if(deliveryDistrict == "Galle" & items[i].deliveryGalle != 0){
                            document.getElementById("deliveryCharge").value = "LKR " + (items[i].deliveryGalle).toLocaleString('en-US');
                            document.getElementById("delivery2").value = "LKR " + (items[i].deliveryGalle).toLocaleString('en-US');
                            document.getElementById("totalPay").value = "LKR " + (items[i].price + items[i].deliveryGalle).toLocaleString('en-US');
                            document.getElementById("deliveryCharge").style.color = "black";
                            document.getElementById("delivery2").style.color = "black";

                            document.getElementById("estimatedArrival").value = items[i].arrivalGalle;
                            document.getElementById("estimatedArrival").style.color = "black";
                        }else if(deliveryDistrict == "Galle" & items[i].deliveryGalle == 0){
                            document.getElementById("deliveryCharge").value = "Delivery not available for Galle";
                            document.getElementById("delivery2").value = "Delivery not available for Galle";
                            document.getElementById("totalPay").value = "LKR " + (items[i].price + items[i].deliveryGalle).toLocaleString('en-US');
                            document.getElementById("deliveryCharge").style.color = "red";
                            document.getElementById("delivery2").style.color = "red";

                            document.getElementById("estimatedArrival").value = "Delivery not available for Galle";
                            document.getElementById("estimatedArrival").style.color = "red";
                        }


                        document.getElementById("subtotal").value = "LKR " + (items[i].price).toLocaleString('en-US');
                    }
                }
 
            }

            setPageDetails();


            // Switch to image 1 (colour 1)
            const setImage1 = async() => {
                itemImg.src = clr1;

                document.getElementById("clr1Img").style.border = "3px solid black";
                document.getElementById("clr2Img").style.border = "1px solid black";
                document.getElementById("clr3Img").style.border = "1px solid black";
            }


            // Switch to image 2 (colour 2)
            const setImage2 = async() => {
                itemImg.src = clr2;

                document.getElementById("clr1Img").style.border = "1px solid black";
                document.getElementById("clr2Img").style.border = "3px solid black";
                document.getElementById("clr3Img").style.border = "1px solid black";
            }


            // Switch to image 3 (colour 3)
            const setImage3 = async() => {
                itemImg.src = clr3;

                document.getElementById("clr1Img").style.border = "1px solid black";
                document.getElementById("clr2Img").style.border = "1px solid black";
                document.getElementById("clr3Img").style.border = "3px solid black";
            }



            document.getElementById("district").onchange = function() {setDFEA()};

            const setDFEA = async() => {
                // Set product details
                let response1 = await fetch(`http://localhost:8080/findUserProducts/${sellerId}`);
                let items = await response1.json();

                for (let i = 0; i < items.length; i++) {
                    if(items[i].itemId == productId){
                        var deliveryDistrict = document.getElementById("district").value;
                        
                        if(deliveryDistrict == "Colombo" & items[i].deliveryColombo != 0){
                            document.getElementById("deliveryCharge").value = "LKR " + (items[i].deliveryColombo).toLocaleString('en-US');
                            document.getElementById("delivery2").value = "LKR " + (items[i].deliveryColombo).toLocaleString('en-US');
                            document.getElementById("totalPay").value = "LKR " + (items[i].price + items[i].deliveryColombo).toLocaleString('en-US');
                            document.getElementById("deliveryCharge").style.color = "black";
                            document.getElementById("delivery2").style.color = "black";

                            document.getElementById("estimatedArrival").value = items[i].arrivalColombo;
                            document.getElementById("estimatedArrival").style.color = "black";
                        }else if(deliveryDistrict == "Colombo" & items[i].deliveryColombo == 0){
                            document.getElementById("deliveryCharge").value = "Delivery not available for Colombo";
                            document.getElementById("delivery2").value = "Delivery not available for Colombo";
                            document.getElementById("totalPay").value = "LKR " + (items[i].price + items[i].deliveryColombo).toLocaleString('en-US');
                            document.getElementById("deliveryCharge").style.color = "red";
                            document.getElementById("delivery2").style.color = "red";

                            document.getElementById("estimatedArrival").value = "Delivery not available for Colombo";
                            document.getElementById("estimatedArrival").style.color = "red";
                        }

                        if(deliveryDistrict == "Galle" & items[i].deliveryGalle != 0){
                            document.getElementById("deliveryCharge").value = "LKR " + (items[i].deliveryGalle).toLocaleString('en-US');
                            document.getElementById("delivery2").value = "LKR " + (items[i].deliveryGalle).toLocaleString('en-US');
                            document.getElementById("totalPay").value = "LKR " + (items[i].price + items[i].deliveryGalle).toLocaleString('en-US');
                            document.getElementById("deliveryCharge").style.color = "black";
                            document.getElementById("delivery2").style.color = "black";

                            document.getElementById("estimatedArrival").value = items[i].arrivalGalle;
                            document.getElementById("estimatedArrival").style.color = "black";
                        }else if(deliveryDistrict == "Galle" & items[i].deliveryGalle == 0){
                            document.getElementById("deliveryCharge").value = "Delivery not available for Galle";
                            document.getElementById("delivery2").value = "Delivery not available for Galle";
                            document.getElementById("totalPay").value = "LKR " + (items[i].price + items[i].deliveryGalle).toLocaleString('en-US');
                            document.getElementById("deliveryCharge").style.color = "red";
                            document.getElementById("delivery2").style.color = "red";

                            document.getElementById("estimatedArrival").value = "Delivery not available for Galle";
                            document.getElementById("estimatedArrival").style.color = "red";
                        }
                    }
                }
            }

            
        </script>
    </body>
</html>
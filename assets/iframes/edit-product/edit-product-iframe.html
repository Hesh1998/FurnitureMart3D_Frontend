<!DOCTYPE html>
<html lang="en">

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link href="../css/style.css" rel="stylesheet">
        <link href="../list-product/list-product-style.css" rel="stylesheet">
        <link href="../buyer-dashboard/buyer-dashboard-style.css" rel="stylesheet">
        
        
    </head>

    <body>
        <div class="clsBorder" style="margin-top: 150px;">
            <div class="div2">
                <div>
                    <h1 style="padding-top: 10px; padding-bottom: 10px; padding-left: 15px;">1. Item Details</h1>
                </div> 
            </div>

            <div class="clsFrm1">
                <div class="cls1">
                    <label for="itemname" style="padding-right: 10px;">Item Name *</label><br>
                    <input type="text" id="itemname" placeholder="Enter item name"><br>
                </div>
                <br>

                <br>

                <div class="cls2">
                    <label for="category">Category *</label><br><br>
                    
                    <input type="checkbox" id="livingroom" name="livingroom" value="Living Room">
                    <label for="livingroom">Living Room</label>

                    <input type="checkbox" id="dining" name="dining" value="Dining" style="margin-left: 40px;">
                    <label for="dining">Dining</label>

                    <input type="checkbox" id="bedroom" name="bedroom" value="Bedroom" style="margin-left: 40px;">
                    <label for="bedroom">Bedroom</label>

                    <input type="checkbox" id="office" name="office" value="Office" style="margin-left: 40px;">
                    <label for="office">Office</label>

                    <input type="checkbox" id="outdoor" name="outdoor" value="Outdoor" style="margin-left: 40px;">
                    <label for="outdoor">Outdoor</label>

                    <input type="checkbox" id="other" name="other" value="Other" style="margin-left: 40px;">
                    <label for="other">Other</label>
                </div>
                <br>

                <div class="cls1">
                    <label for="condition" style="padding-right: 10px;">Condition *</label><br>
                    <input type="text" id="condition" placeholder="Enter item condition  (e.g. - Brandnew, used, ....)"><br>
                </div>
                <br>

                <div class="cls1">
                    <label for="description" style="padding-right: 10px;">Description *</label><br>
                    <textarea id="description" id="description" rows="4" cols="50" placeholder="Enter item description"></textarea>
                </div>
                <br>

                <div class="cls1">
                    <label for="dimensions" style="padding-right: 10px;">Dimensions *</label><br>
                    <textarea id="dimensions" id="dimensions" rows="4" cols="50" placeholder="Enter item dimensions"></textarea>
                </div>
                <br>

                <div class="cls1">
                    <label for="stock" style="padding-right: 10px;">Quantity in Stock *</label><br>
                    <input type="text" id="stock" placeholder="Enter quantity in stock" style="width: 89.5%;">
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 13px; padding-right: 13px; margin-left: 20px;" onclick="inc()"> + </button>
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 15px; padding-right: 15px; margin-left: 20px;" onclick="dec()"> - </button>
                </div>
                <br>

                <div class="cls1">
                    <label for="price" style="padding-right: 10px;">Price (LKR) *</label><br>
                    <input type="text" id="price" placeholder="Enter item price"><br>
                </div>
                <br>

                <div class="cls1">
                    <label for="delivery" style="padding-right: 10px;">Delivery Fee (LKR) *</label><br>
                    <input type="text" id="delivery" placeholder="Enter delivery fee"><br>
                </div>
                <br>

                <div class="cls1">
                    <label for="arrival" style="padding-right: 10px;">Estimated Arrival (days) *</label><br>
                    <input type="text" id="arrival" placeholder="Enter estimated arrival days" style="width: 89.5%;">
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 13px; padding-right: 13px; margin-left: 20px;" onclick="incD()"> + </button>
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 15px; padding-right: 15px; margin-left: 20px;" onclick="decD()"> - </button>
                </div>
            </div>
        </div>

        <div class="clsBorder" style="margin-top: 100px;">
            <div class="div2">
                <div>
                    <h1 style="padding-top: 10px; padding-bottom: 10px; padding-left: 15px;">2. Material Details</h1>
                </div> 
            </div>

            <div class="clsFrm1">
                <div class="cls1">
                    <label for="material" style="padding-right: 10px;">Material *</label><br>
                    <input type="text" id="material" placeholder="Enter item material"><br>
                </div>
                <br>

                <div class="cls1">
                    <label for="clr1" style="padding-right: 10px;">Material Color Code 1 *</label><br>
                    <input type="text" id="clr1" placeholder="Enter item material color code 1 (e.g. - #FFFFFF)"><br>
                </div>
                <br>

                <div class="cls1">
                    <label style="padding-right: 10px;">Color 1 item image *</label><br><br>
                    <img id="clr1Img" src="../../../../../Resources/istockphoto-1357365823-612x612.jpg" width="306" height="229.5">
                    <input type="file" id="clr1ImgInput" style="width: 87.3%;">
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 13px; padding-right: 13px; margin-left: 20px;" onclick="resetImg1()"> Clear Image </button>
                </div>
                <br>

                <div class="cls1">
                    <label for="clr2" style="padding-right: 10px;">Material Color Code 2</label><br>
                    <input type="text" id="clr2" placeholder="Enter item material color code 2 (e.g. - #FFFFFF)"><br>
                </div>
                <br>

                <div class="cls1">
                    <label style="padding-right: 10px;">Color 2 item image</label><br><br>
                    <img id="clr2Img" src="../../../../../Resources/istockphoto-1357365823-612x612.jpg" width="306" height="229.5">
                    <input type="file" id="clr2ImgInput"  style="width: 87.3%;">
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 13px; padding-right: 13px; margin-left: 20px;" onclick="resetImg2()"> Clear Image </button>
                </div>
                <br>

                <div class="cls1">
                    <label for="clr3" style="padding-right: 10px;">Material Color Code 3</label><br>
                    <input type="text" id="clr3" placeholder="Enter item material color code 3 (e.g. - #FFFFFF)"><br>
                </div>
                <br>

                <div class="cls1">
                    <label style="padding-right: 10px;">Color 3 item image</label><br><br>
                    <img id="clr3Img" src="../../../../../Resources/istockphoto-1357365823-612x612.jpg" width="306" height="229.5">
                    <input type="file" id="clr3ImgInput"  style="width: 87.3%;">
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 13px; padding-right: 13px; margin-left: 20px;" onclick="resetImg3()"> Clear Image </button>
                </div>
                <br>
            </div>
        </div>


        <div class="clsBorder" style="margin-top: 100px;">
            <div class="div2">
                <div>
                    <h1 style="padding-top: 10px; padding-bottom: 10px; padding-left: 15px;">3. Additional Graphics</h1>
                </div> 
            </div>

            <div class="clsFrm1">
                <div class="cls1">
                    <label style="padding-right: 10px;">Additional Image 1 *</label><br><br>
                    <img id="add1Img" src="../../../../../Resources/istockphoto-1357365823-612x612.jpg" width="306" height="229.5">
                    <input type="file" id="add1ImgInput"  style="width: 87.3%;">
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 13px; padding-right: 13px; margin-left: 20px;" onclick="resetAdd1()"> Clear Image </button>
                </div>
                <br>

                <div class="cls1">
                    <label style="padding-right: 10px;">Additional Image 2</label><br><br>
                    <img id="add2Img" src="../../../../../Resources/istockphoto-1357365823-612x612.jpg" width="306" height="229.5">
                    <input type="file" id="add2ImgInput" style="width: 87.3%;">
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 13px; padding-right: 13px; margin-left: 20px;" onclick="resetAdd2()"> Clear Image </button>
                </div>
                <br>

                <div class="cls1">
                    <label style="padding-right: 10px;">Video 1</label><br><br>
                    <video id="vid1" width="320" height="240" controls>
                        <source id="mp4_src1" src="" type="video/mp4">
                    </video>
                    <input type="file" id="vid1Input" class="form-control"  style="width: 87.4%;">
                    <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding-top: 10px; padding-bottom: 10px; padding-left: 13px; padding-right: 13px; margin-left: 20px;" onclick="resetVid1()"> Clear Video </button>
                </div>
                <br>
                
            </div>
        </div>

        <br><br><br>
        <div class="mt-5 text-right" style="display: flex; justify-content: right">
            <button class="btn btn-primary profile-button" type="button" style="font-size: large; padding: 10px;" onclick="updateProduct()">Update Product</button>
        </div>


        <script>
            // Upload Color 1 Image
            const clr1ImgInput = document.getElementById("clr1ImgInput");
            
            clr1ImgInput.addEventListener("change", e=> {
                const file = clr1ImgInput.files[0];
                const reader = new FileReader();

                reader.addEventListener("load", () => {
                    document.getElementById("clr1Img").src = reader.result;
                });

                reader.readAsDataURL(file);
            });

            // Reset Color 1 Image
            const resetImg1 = async() => {
                document.getElementById("clr1Img").src = "../../../../../Resources/istockphoto-1357365823-612x612.jpg";
                document.getElementById("clr1ImgInput").value = "";
            }

            // Upload Color 2 Image
            const clr2ImgInput = document.getElementById("clr2ImgInput");
            
            clr2ImgInput.addEventListener("change", e=> {
                const file = clr2ImgInput.files[0];
                const reader = new FileReader();

                reader.addEventListener("load", () => {
                    document.getElementById("clr2Img").src = reader.result;
                });

                reader.readAsDataURL(file);
            });

            // Reset Color 2 Image
            const resetImg2 = async() => {
                document.getElementById("clr2Img").src = "../../../../../Resources/istockphoto-1357365823-612x612.jpg";
                document.getElementById("clr2ImgInput").value = "";
            }

            // Upload Color 3 Image
            const clr3ImgInput = document.getElementById("clr3ImgInput");
            
            clr3ImgInput.addEventListener("change", e=> {
                const file = clr3ImgInput.files[0];
                const reader = new FileReader();

                reader.addEventListener("load", () => {
                    document.getElementById("clr3Img").src = reader.result;
                });

                reader.readAsDataURL(file);
            });

            // Reset Color 3 Image
            const resetImg3 = async() => {
                document.getElementById("clr3Img").src = "../../../../../Resources/istockphoto-1357365823-612x612.jpg";
                document.getElementById("clr3ImgInput").value = "";
            }

            // Upload Additional Image 1
            const add1ImgInput = document.getElementById("add1ImgInput");
            
            add1ImgInput.addEventListener("change", e=> {
                const file = add1ImgInput.files[0];
                const reader = new FileReader();

                reader.addEventListener("load", () => {
                    document.getElementById("add1Img").src = reader.result;
                });

                reader.readAsDataURL(file);
            });

            // Reset Additional Image 1
            const resetAdd1 = async() => {
                document.getElementById("add1Img").src = "../../../../../Resources/istockphoto-1357365823-612x612.jpg";
                document.getElementById("add1ImgInput").value = "";
            }

            // Upload Additional Image 2
            const add2ImgInput = document.getElementById("add2ImgInput");
            
            add2ImgInput.addEventListener("change", e=> {
                const file = add2ImgInput.files[0];
                const reader = new FileReader();

                reader.addEventListener("load", () => {
                    document.getElementById("add2Img").src = reader.result;
                });

                reader.readAsDataURL(file);
            });

            // Reset Additional Image 2
            const resetAdd2 = async() => {
                document.getElementById("add2Img").src = "../../../../../Resources/istockphoto-1357365823-612x612.jpg";
                document.getElementById("add2ImgInput").value = "";
            }

            // Upload Video 1
            const vid1 = document.getElementById("vid1");
            const vid1Input = document.getElementById("vid1Input");
            
            vid1Input.addEventListener("change", e=> {
                const file = vid1Input.files[0];
                const fileName = file.name;
                extension = fileName.split('.').pop();
                
                const reader = new FileReader();

                reader.addEventListener("load", () => {
                    if(extension == "mp4"){
                        vid1.src = reader.result;
                        vid1.load();
                    }else{
                        alert("Only MP4 videos are allowed!");
                    }
                });

                reader.readAsDataURL(file);
            });

            // Reset Video 1
            const resetVid1 = async() => {
                vid1.src = "";
                vid1Input.value = "";
            }

            // Code related to setting page details
            var id = localStorage.getItem("id");
            var itemId = localStorage.getItem("itemId");

            const setPageDetails = async() => {
                let response1 = await fetch(`http://localhost:8080/findUserProducts/${id}`);
			    let items = await response1.json();

                for (let i = 0; i < items.length; i++) {
                    if(items[i].itemId == itemId){
                        document.getElementById("itemname").value = items[i].itemName;

                        if(items[i].living == "true"){
                            document.getElementById("livingroom").checked = true;
                        }

                        if(items[i].dining == "true"){
                            document.getElementById("dining").checked = true;
                        }

                        if(items[i].bedroom == "true"){
                            document.getElementById("bedroom").checked = true;
                        }

                        if(items[i].office == "true"){
                            document.getElementById("office").checked = true;
                        }

                        if(items[i].outdoor == "true"){
                            document.getElementById("outdoor").checked = true;
                        }

                        if(items[i].other == "true"){
                            document.getElementById("other").checked = true;
                        }

                        document.getElementById("condition").value = items[i].condition;
                        document.getElementById("description").value = items[i].description;
                        document.getElementById("dimensions").value = items[i].dimensions;
                        document.getElementById("stock").value = items[i].stockQuantity;
                        document.getElementById("price").value = items[i].price;
                        document.getElementById("delivery").value = items[i].deliveryFee;
                        document.getElementById("arrival").value = items[i].arrivalDays;
                        document.getElementById("material").value = items[i].material;
                        document.getElementById("clr1").value = items[i].clr1;
                        document.getElementById("clr1Img").src = items[i].clr1Img;

                        if(items[i].clr2 != ""){
                            document.getElementById("clr2").value = items[i].clr2;
                            document.getElementById("clr2Img").src = items[i].clr2Img;
                        }

                        if(items[i].clr3 != ""){
                            document.getElementById("clr3").value = items[i].clr3;
                            document.getElementById("clr3Img").src = items[i].clr3Img;
                        }

                        document.getElementById("add1Img").src = items[i].add1Img;

                        if(items[i].add2Img != "NA"){
                            document.getElementById("add2Img").src = items[i].add2Img;
                        }

                        if(items[i].vid1 != "NA"){
                            document.getElementById("vid1").src = items[i].vid1;
                        }

                        break;
                    }
                }
            }

            setPageDetails();

            function inc(){
                document.getElementById("stock").value = Number(document.getElementById("stock").value) + 1;
            }

            function dec(){
                document.getElementById("stock").value = Number(document.getElementById("stock").value) - 1;
            }

            function incD(){
                document.getElementById("arrival").value = Number(document.getElementById("arrival").value) + 1;
            }

            function decD(){
                document.getElementById("arrival").value = Number(document.getElementById("arrival").value) - 1;
            }


            // Updating product details
            const updateProduct = async() => {
                // Get values to variables
                var itemName = document.getElementById("itemname").value;

                var livingroom = document.getElementById("livingroom").checked;
                var dining = document.getElementById("dining").checked;
                var bedroom = document.getElementById("bedroom").checked;
                var office = document.getElementById("office").checked;
                var outdoor = document.getElementById("outdoor").checked;
                var other = document.getElementById("other").checked;

                var condition = document.getElementById("condition").value;
                var description = document.getElementById("description").value;
                var dimensions = document.getElementById("dimensions").value;
                var stock = document.getElementById("stock").value;
                var price = document.getElementById("price").value;
                var delivery = document.getElementById("delivery").value;
                var arrival = document.getElementById("arrival").value;
                var material = document.getElementById("material").value;
                
                var clr1 = document.getElementById("clr1").value;
                var clr1Img = document.getElementById("clr1Img").src;
                var clr2 = document.getElementById("clr2").value;
                var clr2Img = document.getElementById("clr2Img").src;
                var clr3 = document.getElementById("clr3").value;
                var clr3Img = document.getElementById("clr3Img").src;
                
                var add1Img = document.getElementById("add1Img").src;
                var add2Img = document.getElementById("add2Img").src;
                var vid1 = document.getElementById("vid1").src;

                // Assign default values to images / videos without uploads
                if(clr1Img == "file:///E:/UOK%20MIT/Level%203/Sem%201/INTE%2034263%20-%20System%20Development%20Project/Resources/istockphoto-1357365823-612x612.jpg"){
                    clr1Img = "NA";
                }

                if(clr2Img == "file:///E:/UOK%20MIT/Level%203/Sem%201/INTE%2034263%20-%20System%20Development%20Project/Resources/istockphoto-1357365823-612x612.jpg"){
                    clr2Img = "NA";
                }

                if(clr3Img == "file:///E:/UOK%20MIT/Level%203/Sem%201/INTE%2034263%20-%20System%20Development%20Project/Resources/istockphoto-1357365823-612x612.jpg"){
                    clr3Img = "NA";
                }

                if(add1Img == "file:///E:/UOK%20MIT/Level%203/Sem%201/INTE%2034263%20-%20System%20Development%20Project/Resources/istockphoto-1357365823-612x612.jpg"){
                    add1Img = "NA";
                }

                if(add2Img == "file:///E:/UOK%20MIT/Level%203/Sem%201/INTE%2034263%20-%20System%20Development%20Project/Resources/istockphoto-1357365823-612x612.jpg"){
                    add2Img = "NA";
                }
                
                if(vid1 == ""){
                    vid1 = "NA";
                }

                // Validations
                if(itemName == ""){
                    alert("Please enter an item name!");
                }else if(livingroom == false & dining == false & bedroom == false & office == false & outdoor == false & other == false){
                    alert("Please select atleaset one category!");
                }else if(condition == ""){
                    alert("Please enter item condition!");
                }else if(description == ""){
                    alert("Please enter item description!");
                }else if(dimensions == ""){
                    alert("Please enter item dimensions!");
                }else if(stock == ""){
                    alert("Please enter a valid number for quantity in stock!");
                }else if(isNaN(stock)){
                    alert("Please enter a valid number for quantity in stock!");
                }else if(stock.includes(".")){
                    alert("Please enter a valid number for quantity in stock!");
                }else if(price == "" || isNaN(price)){
                    alert("Please enter a valid item price!");
                }else if(delivery == "" || isNaN(delivery)){
                    alert("Please enter a valid item delivery fee!");
                }else if(arrival == ""){
                    alert("Please enter a valid number for estimated arrival days!");
                }else if(isNaN(arrival)){
                    alert("Please enter a valid number for estimated arrival days!");  
                }else if(arrival.includes(".")){
                    alert("Please enter a valid number for estimated arrival days!");  
                }else if(material == ""){
                    alert("Please enter item material!");
                }else if(clr1 == ""){
                    alert("Please enter a valid material color code 1!");
                }else if(clr1.length != 7 || clr1.charAt(0) != "#"){
                    alert("Please enter a valid material color code 1!");
                }else if(clr1Img == "NA"){
                    alert("Please enter color 1 item image!");
                }else if(clr2 != "" & clr2Img != "NA" & (clr2.length != 7 || clr2.charAt(0) != "#")){
                    alert("Please enter a valid material color code 2!");
                }else if(clr2 != "" & clr2Img == "NA"){
                    alert("Please enter color 2 item image!");
                }else if(clr2 == "" & clr2Img != "NA"){
                    alert("Please enter a valid material color code 2!");
                }else if(clr3 != "" & clr3Img != "NA" & (clr3.length != 7 || clr3.charAt(0) != "#")){
                    alert("Please enter a valid material color code 3!");
                }else if(clr3 != "" & clr3Img == "NA"){
                    alert("Please enter color 3 item image!");
                }else if(clr3 == "" & clr3Img != "NA"){
                    alert("Please enter a valid material color code 3!");
                }else if(add1Img == "NA"){
                    alert("Please enter additional image 1!");
                }else{
                    var object = {};

                    object["userId"] = id;
                    object["itemId"] = itemId;
                    object["itemName"] = itemName;
                    object["living"] = livingroom;
                    object["dining"] = dining;
                    object["bedroom"] = bedroom;
                    object["office"] = office;
                    object["outdoor"] = outdoor;
                    object["other"] = other;
                    object["condition"] = condition;
                    object["description"] = description;
                    object["dimensions"] = dimensions;
                    object["stockQuantity"] = stock;

                    let response2 = await fetch(`http://localhost:8080/findUserProducts/${id}`);
                    let items1 = await response2.json();
                    for (let i = 0; i < items1.length; i++) {
                        if(items1[i].itemId == itemId){
                            object["inOrder"] = items1[i].inOrder;
                            object["totalSold"] = items1[i].totalSold;
                        }
                    }

                    object["price"] = price;
                    object["deliveryFee"] = delivery;
                    object["arrivalDays"] = arrival;
                    object["material"] = material;
                    object["clr1"] = clr1;
                    object["clr1Img"] = clr1Img;
                    object["clr2"] = clr2;
                    object["clr2Img"] = clr2Img;
                    object["clr3"] = clr3;
                    object["clr3Img"] = clr3Img;
                    object["add1Img"] = add1Img;
                    object["add2Img"] = add2Img;
                    object["vid1"] = vid1;

                    var jsonText = JSON.stringify(object);
                    console.log(jsonText);
			
                    await fetch("http://localhost:8080/updateProduct", {
                        method: "POST",
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        body: jsonText
                    })
                    .then(response => response.text())
                    .then(open("../../../seller-products.html", "_parent"))
                    .catch(error => console.log('Authorization failed: ' + error.message));
                }
            }

        </script>
    </body>

</html>